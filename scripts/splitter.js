(function(){var _NAME_MULTIPLE_REGEXP=/\[\]$/;Form.Element.setValue=function(form,name,value){form=$(form);var element=form.elements.namedItem(name);if(!element.tagName){element=element.item(0);};switch(element.type){case 'checkbox':element.checked=_NAME_MULTIPLE_REGEXP.test(element.name)?value.indexOf(element.value)>=0:(Boolean(value)&&(value!='0'));break;case 'select-one':var index=-1;$A(element.options).each(function(oOption,i){if(oOption.value==value){index=i;throw $break;}});element.selectedIndex=index;break;case 'select-multiple':$A(element.options).each(function(oOption){oOption.selected=value.indexOf(oOption.value)>0;});break;case 'radio':$A(form.elements).findAll(function(element){return element.name&&element.name==name&&'radio'==element.type;}).each(function(element){element.checked=(element.value==value);});break;default:element.value=value;break;}};Abstract.EventObserver.prototype.registerCallback=function(element){if(element.type){switch(element.type.toLowerCase()){case 'checkbox':case 'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;case 'password':case 'text':case 'textarea':var self=this;Event.observe(element,'keydown',(function(){window.setTimeout(function(){self.onElementEvent.apply(self,arguments);});}).bind(this));break;case 'select-one':case 'select-multiple':Event.observe(element,'change',this.onElementEvent.bind(this));break;}}};})();var Splitter={'outputSettings':function(){Splitter.Settings.getParams().each(function(pair){Form.Element.setValue('the-form',pair.key,pair.value);});Splitter.FormObserver();},'settingsFromForm':function(){Splitter.Settings.getParams().keys().each(function(param){if('storage'==param||'encoding'==param){value=radio_value('the-form',param);}else{var element=$(param);if(element){value='checkbox'==element.type?element.checked:element.value;}};Splitter.Settings.setParam(param,value);});},'Element':{'disable':function(element){Splitter.Element.setAbilility(element,false)},'enable':function(element){Splitter.Element.setAbilility(element,true);},'setAbilility':function(element,ability){var element=$(element);var className=element.type+'-disabled';var method=ability?'removeClassName':'addClassName';Element[method](element,className);element.disabled=!ability;}},'FormObserver':function(){Splitter.Element.setAbilility('save-as',!$F('url').match('\n'));var useProxy=$('use-proxy').checked;Splitter.Element.setAbilility('proxy-host',useProxy);Splitter.Element.setAbilility('proxy-port',useProxy);Splitter.Element.setAbilility('proxy-user',useProxy);Splitter.Element.setAbilility('proxy-password',useProxy);var autoResume=$('use-auto-resume').checked;Splitter.Element.setAbilility('auto-resume-interval',autoResume);Splitter.Element.setAbilility('auto-resume-count',autoResume);var isPost=radio_value('the-form','method')=='post';Element[isPost?'show':'hide']('post-params');var storage=radio_value('the-form','storage');Element[storage=='email'?'show':'hide']('field-email');Element[storage=='file'?'show':'hide']('field-file');var rename=$('rename').checked;Splitter.Element.setAbilility('rename-search',rename);Splitter.Element.setAbilility('rename-replace',rename);Splitter.Element.setAbilility('rename-regexp',rename);},'onload':function(){controller=new Splitter.Controller();new Form.EventObserver('the-form',Splitter.FormObserver);$('the-form').onsubmit=function(){Splitter.settingsFromForm();controller.reset();};$('the-form').reset();Splitter.outputSettings();}};function radio_value(form,name){var checked=Form.getElements(form).detect(function(element){return element.name==name&&element.checked;});return checked?checked.value:null;};var controller;function switchOptions(){Element.toggle('options');};Splitter.Controller=Class.create();Splitter.Controller.prototype={_log:null,_indicator:null,_section:null,_interactive:false,initialize:function(container){this._log=new Splitter.Log('log-container');this._indicator=new Splitter.Indicator();this.reset();},trace:function(type,date,message){this._log.register(type,date,message);},clear:function(){this._log.clear();this.reset();},reset:function(){this._section=new Splitter.Section;this._update();},counter:function(value){new Splitter.Counter($('button-download'),value,!this._interactive);},captcha:function(param,src){$('captcha-container').show();$('captcha-image').src=src;this.param('captcha-param',param);this._interactive=true;},param:function(name,value){Form.Element.setValue('the-form',name,value);Splitter.FormObserver();},onFileNameChange:function(name){this._section.setName(name);this._update();},onFileSizeChange:function(size){this._section.setSize(size);this._update();},onProgressChange:function(progress){this._section.setProgress(progress);this._update();},_update:function(){this._indicator.update(this._section);}};Splitter.Section=Class.create();Splitter.Section.prototype={_name:null,_size:null,_state1:null,_state2:null,initialize:function(){},getName:function(){return this._name;},setName:function(name){this._name=name;},getSize:function(){return this._size;},setSize:function(size){this._size=parseInt(size);},getProgress:function(){return this._state2?this._state2.progress:null;},setProgress:function(progress){this._state1=this._state2;this._state2=this._createState(progress);},getPercent:function(){return this._size>0&&this._state2?Math.floor(100*this._state2.progress/this._size):null;},getSpeed:function(){return this._state1?1000*(this._state2.progress-this._state1.progress)/(this._state2.timestamp-this._state1.timestamp):null;},getRemaining:function(){var speed=this.getSpeed();return speed>0&&this._size>0?(this._size-this._state2.progress)/speed:null;},_createState:function(progress){return new Splitter.Section.State((new Date).getTime(),progress);}};Splitter.Section.State=function(timestamp,progress){this.timestamp=timestamp;this.progress=progress;};Splitter.Indicator=Class.create();Splitter.Indicator.prototype={_caption:document.title,initialize:function(){},update:function(section){var name=section.getName(),size=section.getSize(),progress=section.getProgress(),percent=section.getPercent(),speed=section.getSpeed(),remaining=section.getRemaining();this._updateCaption(name,percent);this._updateFilename(name);this._updateSize(size);this._updateProgress(progress);this._updatePercent(percent);this._updateSpeed(speed);this._updateRemaining(remaining);},_updateCaption:function(name,percent){var caption='';if(percent>0){caption+=percent+'% of ';};if(name!=null){caption+=name+' - ';};document.title=caption+this._caption;},_updateFilename:function(value){$('filename-value').update(value||'');},_updateSize:function(value){$('size-value').update(this._formatNumber(value));},_updateProgress:function(value){$('progress-value').update(this._formatNumber(value));},_updatePercent:function(value){$('progress-bar').style.width=(value||0)+'%';$('percent-value').update(value!==null?this._formatNumber(Math.round(value)):'');},_updateSpeed:function(value){$('speed-value').update(value!==null?this._formatNumber(Math.round(value)):'');},_updateRemaining:function(value){$('remaining-value').update(value!==null?this._formatTime(Math.round(value)):'');},_formatNumber:function(value){var string=value>0?String(value):'',length=string.length,formatted='';for(var i=0;i<length;i++){formatted+=string.substr(i,1);if((i<length-1)&&(1==(length-i)%3)){formatted+=' ';}};return formatted;},_formatTime:function(value){var hours=Math.floor(value/3600),minutes=Math.floor((value-hours*3600)/60),seconds=value-hours*3600-minutes*60;return this._lz(hours)+':'+this._lz(minutes)+':'+this._lz(seconds);},_lz:function(value){return String(value<10?'0'+value:value);}};Splitter.Log=Class.create();Splitter.Log.prototype={_table:null,_count:0,initialize:function(container){var table=document.createElement('table');table.cellSpacing=0;table.cellPadding=0;$(container).appendChild(table);this._table=table;},register:function(type,date,messages){var first=true,self=this;var count=++self._count;$A(messages).each(function(message){var row=self._table.insertRow(-1);row.className=type;var cell1=row.insertCell(-1);var cell2=row.insertCell(-1);var cell3=row.insertCell(-1);if(first){cell1.className='icon';cell1.appendChild(document.createTextNode(count));cell2.appendChild(document.createTextNode(date));first=false;};cell2.className='datetime';$(cell3.appendChild(document.createElement('pre'))).update(message);});this._table.parentNode.scrollTop=this._table.scrollHeight;},clear:function(){while(this._table.rows.length>0){this._table.deleteRow(0);};this._count=0;}};(function(){var _EXPIRES_IN_DAYS=7;function setCookie(name,value,expires,path,domain,secure){var curCookie=name+'='+escape(value)+((expires)?'; expires='+expires.toGMTString():'')+((path)?'; path='+path:'')+((domain)?'; domain='+domain:'')+((secure)?'; secure':'');document.cookie=curCookie;};function getCookie(name){var dc=document.cookie;var prefix=name+'=';var begin=dc.indexOf('; '+prefix);if(begin==-1){begin=dc.indexOf(prefix);if(begin!=0)return null;}else{begin+=2;};var end=dc.indexOf(';',begin);if(end==-1){end=dc.length;};return unescape(dc.substring(begin+prefix.length,end));};function unsetCookie(name){document.cookie=name+'=false; expires=Fri, 31 Dec 1999 23:59:59 GMT;';};function _wrapValue(value){var string;switch(typeof value){case 'array':string=value.toString();break;case 'boolean':string=Number(value);break;default:string=String(value);break;};return string;};var Cookie={'getParam':function(sName){return getCookie(sName);},'setParam':function(sName,mValue){if(null !=mValue){var dExpire=new Date;dExpire.setDate(dExpire.getDate()+_EXPIRES_IN_DAYS);setCookie(sName,_wrapValue(mValue),dExpire);}else{unsetCookie(sName);}}};var _params=$H({'use-proxy':false,'proxy-host':'www.proxy.com','proxy-port':'3128','proxy-user':'anonymous','proxy-password':'','use-auto-resume':false,'auto-resume-interval':10,'auto-resume-count':50,'user-agent':'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)','target-file':'files/','target-email':'','storage':'file','split-size':0,'encoding':''});_params.keys().each(function(name){var value=Cookie.getParam(name);if('null'!=String(value)){_params[name]=value;}});Splitter.Settings={'getParam':function(name){returnreturn(name in _params)?_params[name]:null;;},'setParam':function(name,value){_params[name]=value;Cookie.setParam(name,value);},'getParams':function(){return _params;}};})();Splitter.Counter=Class.create();Splitter.Counter.prototype={_displayed:false,initialize:function(button,timeout,autostart){var form=button.form;var onsubmit=form.onsubmit;var self=this,now=this._getTimestamp();form.onsubmit=function(){self._onsubmit(button,now,timeout);return false;};if(autostart){form.onsubmit();};setTimeout(function(){form.onsubmit=onsubmit;},timeout*1000);},_onsubmit:function(button,start,timeout){var now=this._getTimestamp();var remain=timeout+start-now;if(!this._displayed&&remain>0){this._display(button,remain);this._displayed=true;}},_display:function(button,value){var text=button.value;var current=value+1;var handler=function(){button.value=text+' ( '+current+' )';if(current<=0){window.clearInterval(interval);button.value=text;button.click();};current--;};handler.call(window);var interval=window.setInterval(handler,1000);},_getTimestamp:function(){return Math.round(new Date().getTime()/1000);}};document.onactivate=document.ondeactivate=function(){var element=$(window.event.srcElement);var className='focus';if(/text|password|file|select/.test(element.type)&&!element.getAttribute('readonly')){switch(event.type){case 'activate':element.addClassName(className);break;case 'deactivate':element.removeClassName(className);break;}}};

